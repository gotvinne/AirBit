name: PR Check

on:
  pull_request:

jobs:
  clang-formatting:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install clang-format
        run: sudo apt-get install -y clang-format

      - name: Check formatting in /src
        run: |
          find ./src \( -iname '*.h' -o -iname '*.cpp' \) -print0 | xargs -0 clang-format --dry-run --Werror

  micro-build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: install build dependancies
        run: sudo apt install gcc python3 cmake gcc-arm-none-eabi binutils-arm-none-eabi

      - name: microinstall
        run: |
          chmod +x microinstall.sh
          ./microinstall.sh
      
      - name: Add path to terminal
        run:
          echo 'source /home/runner/work/AirBit/AirBit/aliases.sh' >> ~/.bashrc
          source ~/.bashrc

      - name: Add micro-tools to path
        run: |
          source ./aliases.sh
          chmod +x ./aliases.sh
          ./aliases.sh

      - name: microbuild
        run: |
          chmod +x ./microbuild.sh
          ./microbuild.sh BUILD_DIRECTORY=./src